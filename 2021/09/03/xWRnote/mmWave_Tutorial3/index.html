<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="前言在前两个 tutorial 中我们通过编写脚本程序的方法得到了毫米波雷达输出的点云数据, 并进行了相关的数据可视化工作, 在这一篇博客当中我们将通过之前得到的毫米波雷达输出的点云, 进行人员的检测跟踪以及航迹的管理, 到这里读者可能会问了既然在ti官方的demo中已经给出了 gtrack相应的多目标跟踪算法的实现, 我们为什么又要重新写一遍呢? 这不是重复造轮子吗? 但其实对于处在学习阶段的我">
<meta property="og:type" content="article">
<meta property="og:title" content="mmWave_Tutorial3-快速上手Target tracking and management">
<meta property="og:url" content="https://example.com/2021/09/03/xWRnote/mmWave_Tutorial3/index.html">
<meta property="og:site_name" content="Bulijiojio Blog">
<meta property="og:description" content="前言在前两个 tutorial 中我们通过编写脚本程序的方法得到了毫米波雷达输出的点云数据, 并进行了相关的数据可视化工作, 在这一篇博客当中我们将通过之前得到的毫米波雷达输出的点云, 进行人员的检测跟踪以及航迹的管理, 到这里读者可能会问了既然在ti官方的demo中已经给出了 gtrack相应的多目标跟踪算法的实现, 我们为什么又要重新写一遍呢? 这不是重复造轮子吗? 但其实对于处在学习阶段的我">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://example.com/2021/09/03/xWRnote/mmWave_Tutorial3/overview.png">
<meta property="og:image" content="https://example.com/2021/09/03/xWRnote/mmWave_Tutorial3/Data.jpg">
<meta property="og:image" content="https://example.com/2021/09/03/xWRnote/mmWave_Tutorial3/CA_CFAR.jpg">
<meta property="article:published_time" content="2021-09-02T16:27:40.000Z">
<meta property="article:modified_time" content="2021-09-23T15:17:19.072Z">
<meta property="article:author" content="YXY">
<meta property="article:tag" content="mmWave_tutorial">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://example.com/2021/09/03/xWRnote/mmWave_Tutorial3/overview.png">

<link rel="canonical" href="https://example.com/2021/09/03/xWRnote/mmWave_Tutorial3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>mmWave_Tutorial3-快速上手Target tracking and management | Bulijiojio Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Bulijiojio Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">日常摸鱼划水的虾皮--如果公式不能正常显示请使用Chrome浏览器并安装Tex All the Things插件</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://example.com/2021/09/03/xWRnote/mmWave_Tutorial3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="YXY">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bulijiojio Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          mmWave_Tutorial3-快速上手Target tracking and management
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-09-03 00:27:40" itemprop="dateCreated datePublished" datetime="2021-09-03T00:27:40+08:00">2021-09-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-09-23 23:17:19" itemprop="dateModified" datetime="2021-09-23T23:17:19+08:00">2021-09-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/TI-project/" itemprop="url" rel="index"><span itemprop="name">TI project</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>在前两个 tutorial 中我们通过编写脚本程序的方法得到了毫米波雷达输出的点云数据, 并进行了相关的数据可视化工作, 在这一篇博客当中我们将通过之前得到的毫米波雷达输出的点云, 进行人员的检测跟踪以及航迹的管理, 到这里读者可能会问了既然在ti官方的demo中已经给出了 gtrack相应的多目标跟踪算法的实现, 我们为什么又要重新写一遍呢? 这不是重复造轮子吗? 但其实对于处在学习阶段的我们来说, 这样重复造轮子的过程是必须的, 能够让我们快速的熟悉已有的一些成熟的算法, 并且在算法实现的过程中得到更深入的理解以便于我们后面进行更加深入的研究.</p>
<p>在本篇博客当中我们将基于已有的一个小的测试数据进行相关的目标跟踪及航迹管理的算法实现,  这篇博客将给出 matlab和Python 的两个实例. 目标跟踪及航迹管理的原理在这里我们就不进行介绍了, 可以参考目标跟踪有关博客的内容, 下图是在本篇博客中实现的目标跟踪及航迹管理算法的框图.<br><img src="/2021/09/03/xWRnote/mmWave_Tutorial3/overview.png" alt></p>
<h1 id="测试数据"><a href="#测试数据" class="headerlink" title="测试数据"></a>测试数据</h1><p>测试数据的文件我将会尽快的放在个人博客上 </p>
<h2 id="测试数据参数"><a href="#测试数据参数" class="headerlink" title="测试数据参数"></a>测试数据参数</h2><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">参数名</th>
<th style="text-align:center">值</th>
<th style="text-align:center">单位</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">数据每帧的扫描间隔T</td>
<td style="text-align:center">1</td>
<td style="text-align:center">s</td>
</tr>
<tr>
<td style="text-align:center">距离单元格数</td>
<td style="text-align:center">400</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">方位单元格数</td>
<td style="text-align:center">200</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">距离分辨率</td>
<td style="text-align:center">10</td>
<td style="text-align:center">m</td>
</tr>
<tr>
<td style="text-align:center">角度分辨率</td>
<td style="text-align:center">0.5°</td>
<td style="text-align:center">°</td>
</tr>
<tr>
<td style="text-align:center">过程噪声强度</td>
<td style="text-align:center">0.01</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">信噪比SNR</td>
<td style="text-align:center">18</td>
<td style="text-align:center">dB</td>
</tr>
<tr>
<td style="text-align:center">虚警概率</td>
<td style="text-align:center">1e-5</td>
</tr>
</tbody>
</table>
</div>
<p>第五帧测试数据如下图<br><img src="/2021/09/03/xWRnote/mmWave_Tutorial3/Data.jpg" alt><br>这张图中我们可以看到在每一个距离单元与角度单元中都有数值, 那么我们需要进行CFAR处理进而得到检测点 </p>
<h2 id="CA-CFAR结果"><a href="#CA-CFAR结果" class="headerlink" title="CA-CFAR结果"></a>CA-CFAR结果</h2><p>我们将CFAR检测每一帧的结果叠加起来可以得到下图<br><img src="/2021/09/03/xWRnote/mmWave_Tutorial3/CA_CFAR.jpg" alt><br>通过CFAR检测后的点云数据就是我们进行目标跟踪及航迹管理的input </p>
<h1 id="相关代码-Matlab"><a href="#相关代码-Matlab" class="headerlink" title="相关代码(Matlab)"></a>相关代码(Matlab)</h1><h2 id="CA-CFAR代码"><a href="#CA-CFAR代码" class="headerlink" title="CA-CFAR代码"></a>CA-CFAR代码</h2><h3 id="一维CA-CFAR"><a href="#一维CA-CFAR" class="headerlink" title="一维CA-CFAR"></a>一维CA-CFAR</h3><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">[Cfar]</span> = <span class="title">CA_CFAR</span><span class="params">(Signal,PF,Refer,Pro)</span></span></span><br><span class="line"><span class="comment">%CA_CFAR </span></span><br><span class="line"><span class="comment">%Signal input signal</span></span><br><span class="line"><span class="comment">%PF     False Probability</span></span><br><span class="line"><span class="comment">%Refer  Reference Unit</span></span><br><span class="line"><span class="comment">%Pro    Protected Unit</span></span><br><span class="line"></span><br><span class="line">	N_all = <span class="built_in">length</span>(Signal);</span><br><span class="line">	L_slipper = <span class="number">2</span>*(Pro+Refer)+<span class="number">1</span>; <span class="comment">%处理窗的大小</span></span><br><span class="line">	Alpha = L_slipper*(PF^(<span class="number">-1</span>/L_slipper)<span class="number">-1</span>);<span class="comment">%门限系数阿尔法</span></span><br><span class="line"></span><br><span class="line">	Cfar=<span class="built_in">zeros</span>(<span class="number">1</span>,N_all);</span><br><span class="line">	Signal = [<span class="built_in">zeros</span>(<span class="number">1</span>,Refer+Pro) Signal <span class="built_in">zeros</span>(<span class="number">1</span>,Refer+Pro)];</span><br><span class="line">	<span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:N_all</span><br><span class="line">	   Cfar(<span class="built_in">i</span>)=Alpha*<span class="built_in">mean</span>([Signal(<span class="built_in">i</span>:<span class="built_in">i</span>+Refer<span class="number">-1</span>),Signal(<span class="built_in">i</span>+Refer+<span class="number">2</span>*Pro+<span class="number">1</span>:<span class="built_in">i</span>+<span class="number">2</span>*Refer+<span class="number">2</span>*Pro)]);</span><br><span class="line">	<span class="keyword">end</span>`</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h3 id="二维CA-CFAR"><a href="#二维CA-CFAR" class="headerlink" title="二维CA-CFAR"></a>二维CA-CFAR</h3><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">[CFAR]</span> = <span class="title">CA_CFAR2D</span><span class="params">(Signal,PF,Refer,Pro)</span></span></span><br><span class="line"></span><br><span class="line">SIZE = <span class="built_in">size</span>(Signal);</span><br><span class="line">L_slipper = <span class="number">2</span>*(Pro+Refer)+<span class="number">1</span>; <span class="comment">%处理窗的大小</span></span><br><span class="line"></span><br><span class="line">temp=<span class="built_in">zeros</span>(SIZE+[<span class="number">2</span>*(Refer+Pro) <span class="number">2</span>*(Refer+Pro)]);</span><br><span class="line">temp(Refer+Pro+<span class="number">1</span>:Refer+Pro+SIZE(<span class="number">1</span>),Refer+Pro+<span class="number">1</span>:Refer+Pro+SIZE(<span class="number">2</span>)) = Signal;</span><br><span class="line"></span><br><span class="line">Window = <span class="built_in">ones</span>(L_slipper,L_slipper);</span><br><span class="line">Window(Refer+<span class="number">1</span>:Refer+<span class="number">2</span>*Pro+<span class="number">1</span>,Refer+<span class="number">1</span>:Refer+<span class="number">2</span>*Pro+<span class="number">1</span>) = <span class="built_in">zeros</span>(<span class="number">2</span>*Pro+<span class="number">1</span>);</span><br><span class="line">Av_Coff = L_slipper*L_slipper-(Pro*<span class="number">2</span>+<span class="number">1</span>)^<span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">Alpha = Av_Coff*(PF^(<span class="number">-1</span>/L_slipper^<span class="number">2</span>)<span class="number">-1</span>);<span class="comment">%门限系数阿尔法</span></span><br><span class="line"></span><br><span class="line">CFAR = <span class="built_in">zeros</span>(SIZE);</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:SIZE(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">j</span> = <span class="number">1</span>:SIZE(<span class="number">2</span>)</span><br><span class="line">        CFAR(<span class="built_in">i</span>,<span class="built_in">j</span>) = Alpha*sum(sum((temp(<span class="built_in">i</span>:<span class="built_in">i</span>+L_slipper<span class="number">-1</span>,<span class="built_in">j</span>:<span class="built_in">j</span>+L_slipper<span class="number">-1</span>).*Window).^<span class="number">2</span>))/Av_Coff;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h3 id="CA-CFAR使用示例"><a href="#CA-CFAR使用示例" class="headerlink" title="CA-CFAR使用示例"></a>CA-CFAR使用示例</h3><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">clear all</span><br><span class="line">close all</span><br><span class="line">clc</span><br><span class="line"></span><br><span class="line">load(<span class="string">&#x27;Data_For_Test.mat&#x27;</span>);</span><br><span class="line"></span><br><span class="line">result = cell(<span class="number">1</span>,<span class="built_in">size</span>(Data_For_Test.Raw_Data,<span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">Range_Cell_Num = str2num(Data_For_Test.Range_Cell_Num);</span><br><span class="line">Azimuth_Cell_Num = str2num(Data_For_Test.Azimuth_Cell_Num);</span><br><span class="line">P_False_Alarm = str2num(Data_For_Test.P_False_Alarm);</span><br><span class="line">Range_Resolution = <span class="number">10</span>;</span><br><span class="line">Azimuth_Resolution = <span class="number">0.5</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span> = <span class="number">1</span>:<span class="built_in">size</span>(Data_For_Test.Raw_Data,<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">frame = Data_For_Test.Raw_Data&#123;<span class="built_in">i</span>&#125;;</span><br><span class="line"></span><br><span class="line">PF = P_False_Alarm;</span><br><span class="line">Refer = <span class="number">8</span>;</span><br><span class="line">Pro = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">%% 1D cfar</span></span><br><span class="line"><span class="comment">% CFAR_thre = zeros(Range_Cell_Num,Azimuth_Cell_Num);</span></span><br><span class="line"><span class="comment">% for j = 1:Range_Cell_Num</span></span><br><span class="line"><span class="comment">%     CFAR_thre(j,:) = CA_CFAR(frame(j,:),PF,Refer,Pro);</span></span><br><span class="line"><span class="comment">% end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">%% 2D cfar</span></span><br><span class="line">[CFAR_thre] = <span class="built_in">sqrt</span>(CA_CFAR2D(frame,PF,Refer,Pro));</span><br><span class="line"></span><br><span class="line">cfar_detect = (CFAR_thre&lt;frame);</span><br><span class="line">seq = [];</span><br><span class="line">index = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span> k = <span class="number">1</span>:Range_Cell_Num</span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">j</span> = <span class="number">1</span>:Azimuth_Cell_Num</span><br><span class="line">        <span class="keyword">if</span> cfar_detect(k,<span class="built_in">j</span>)</span><br><span class="line">            seq(index,:) = [k <span class="built_in">j</span>];</span><br><span class="line">            index = index + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">seq = [ (seq(:,<span class="number">1</span>)*Range_Resolution).*<span class="built_in">cos</span>((seq(:,<span class="number">2</span>)<span class="number">-100</span>)*Azimuth_Resolution*<span class="built_in">pi</span>/<span class="number">180</span>) seq(:,<span class="number">1</span>)*Range_Resolution.*<span class="built_in">sin</span>((seq(:,<span class="number">2</span>)<span class="number">-100</span>)*Azimuth_Resolution*<span class="built_in">pi</span>/<span class="number">180</span>) ];</span><br><span class="line"></span><br><span class="line">result&#123;<span class="built_in">i</span>&#125; = seq;</span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">figure</span></span><br><span class="line"><span class="built_in">hold</span> on</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span> = <span class="number">1</span>:<span class="number">30</span></span><br><span class="line"><span class="built_in">scatter</span>(result&#123;<span class="built_in">i</span>&#125;(:,<span class="number">1</span>),result&#123;<span class="built_in">i</span>&#125;(:,<span class="number">2</span>));</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">figure</span></span><br><span class="line"><span class="built_in">hold</span> on</span><br><span class="line">mesh(CFAR_thre)</span><br><span class="line">mesh(frame)</span><br></pre></td></tr></table></figure>
<h2 id="卡尔曼滤波"><a href="#卡尔曼滤波" class="headerlink" title="卡尔曼滤波"></a>卡尔曼滤波</h2><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">[x_est,P_k_k]</span> = <span class="title">KalmanFilter</span><span class="params">(z_k,x_est_k_minus1,F,H,P_k,Q,R)</span></span></span><br><span class="line">   x_pre = F*x_est_k_minus1;</span><br><span class="line">   P = F*P_k*F&#x27; + Q;</span><br><span class="line">   </span><br><span class="line">   z_pre = H*x_pre;</span><br><span class="line">   S = H*P*H&#x27; + R;</span><br><span class="line">   K = P*H&#x27;/(S);</span><br><span class="line">   </span><br><span class="line">   x_est = x_pre + K*(z_k - z_pre);</span><br><span class="line">   P_k_k = (<span class="built_in">eye</span>(<span class="built_in">size</span>(K*H,<span class="number">1</span>))-K*H)*P;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h2 id="实验航迹和确认航迹类"><a href="#实验航迹和确认航迹类" class="headerlink" title="实验航迹和确认航迹类"></a>实验航迹和确认航迹类</h2><h3 id="实验航迹类-MN逻辑起始法"><a href="#实验航迹类-MN逻辑起始法" class="headerlink" title="实验航迹类(MN逻辑起始法)"></a>实验航迹类(MN逻辑起始法)</h3><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">classdef</span> MNstarter_KFCV</span><br><span class="line">    <span class="keyword">properties</span></span><br><span class="line">        seq = [];</span><br><span class="line">        M = <span class="number">0</span>;</span><br><span class="line">        N = <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">% Kalman Coefficient</span></span><br><span class="line">        T = <span class="number">1</span>;</span><br><span class="line">        F;</span><br><span class="line">        H = [<span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span>;</span><br><span class="line">             <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span>];</span><br><span class="line">        Gamma;</span><br><span class="line">        Q;</span><br><span class="line">        R;</span><br><span class="line">        </span><br><span class="line">        x_pre = <span class="built_in">zeros</span>(<span class="number">4</span>,<span class="number">1</span>);</span><br><span class="line">        P_k = <span class="built_in">eye</span>(<span class="number">4</span>);</span><br><span class="line">        z_pre = <span class="built_in">zeros</span>(<span class="number">2</span>,<span class="number">1</span>);</span><br><span class="line">        P = <span class="built_in">eye</span>(<span class="number">4</span>);</span><br><span class="line">        S = <span class="built_in">eye</span>(<span class="number">2</span>);</span><br><span class="line">        K = <span class="built_in">zeros</span>(<span class="number">4</span>,<span class="number">2</span>);</span><br><span class="line">        </span><br><span class="line">        x_est = <span class="built_in">zeros</span>(<span class="number">4</span>,<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">methods</span></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">obj</span> = <span class="title">MNstarter_KFCV</span><span class="params">(Z,T)</span></span></span><br><span class="line">            obj.seq = Z;</span><br><span class="line">            obj.T = T;</span><br><span class="line">            obj.F = [<span class="number">1</span> <span class="number">0</span> T <span class="number">0</span>;</span><br><span class="line">                     <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> T;</span><br><span class="line">                     <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span>;</span><br><span class="line">                     <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span>];</span><br><span class="line">            obj.Gamma=[T*T/<span class="number">2</span> <span class="number">0</span>;<span class="number">0</span> T*T/<span class="number">2</span>;T <span class="number">0</span>;<span class="number">0</span> T];</span><br><span class="line">            obj.Q = obj.Gamma*obj.Gamma&#x27;*<span class="number">1</span>;</span><br><span class="line">            obj.R = <span class="number">1</span>*obj.H*obj.H&#x27;;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">obj</span> = <span class="title">predict</span><span class="params">(obj)</span></span></span><br><span class="line">            obj.x_pre = obj.F*obj.seq(<span class="keyword">end</span>,:)&#x27;;</span><br><span class="line">            obj.P = obj.F*obj.P_k*obj.F&#x27; + obj.Q;</span><br><span class="line"></span><br><span class="line">            obj.z_pre = obj.H*obj.x_pre;</span><br><span class="line">            obj.S = obj.H*obj.P*obj.H&#x27; + obj.R;</span><br><span class="line">            obj.K = obj.P*obj.H&#x27;/(obj.S);</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">obj</span> = <span class="title">addseq</span><span class="params">(obj,Z)</span></span></span><br><span class="line">            obj.x_est = obj.x_pre + obj.K*(Z&#x27; - obj.z_pre);</span><br><span class="line">            obj.P_k = (<span class="built_in">eye</span>(<span class="built_in">size</span>(obj.K*obj.H,<span class="number">1</span>))-obj.K*obj.H)*obj.P;</span><br><span class="line">            obj.seq   = [obj.seq;obj.x_est&#x27;];</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h3 id="确认航迹类"><a href="#确认航迹类" class="headerlink" title="确认航迹类"></a>确认航迹类</h3><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">classdef</span> ConfirmTrajectory_KFCV</span><br><span class="line">    <span class="keyword">properties</span></span><br><span class="line">        seq = [];</span><br><span class="line">        scoreboard = <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">% Kalman Coefficient</span></span><br><span class="line">        T = <span class="number">1</span>;</span><br><span class="line">        F;</span><br><span class="line">        H = [<span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span>;</span><br><span class="line">             <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span>];</span><br><span class="line">        Gamma;</span><br><span class="line">        Q;</span><br><span class="line">        R;</span><br><span class="line">        </span><br><span class="line">        x_pre = <span class="built_in">zeros</span>(<span class="number">4</span>,<span class="number">1</span>);</span><br><span class="line">        P_k = <span class="built_in">eye</span>(<span class="number">4</span>);</span><br><span class="line">        z_pre = <span class="built_in">zeros</span>(<span class="number">2</span>,<span class="number">1</span>);</span><br><span class="line">        P = <span class="built_in">eye</span>(<span class="number">4</span>);</span><br><span class="line">        S = <span class="built_in">eye</span>(<span class="number">2</span>);</span><br><span class="line">        K = <span class="built_in">zeros</span>(<span class="number">4</span>,<span class="number">2</span>);</span><br><span class="line">        </span><br><span class="line">        x_est = <span class="built_in">zeros</span>(<span class="number">4</span>,<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">methods</span></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">obj</span> = <span class="title">ConfirmTrajectory_KFCV</span><span class="params">(Z,T)</span></span></span><br><span class="line">            obj.seq = Z;</span><br><span class="line">            obj.T = T;</span><br><span class="line">            obj.F = [<span class="number">1</span> <span class="number">0</span> T <span class="number">0</span>;</span><br><span class="line">                     <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> T;</span><br><span class="line">                     <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span>;</span><br><span class="line">                     <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span>];</span><br><span class="line">            obj.Gamma=[T*T/<span class="number">2</span> <span class="number">0</span>;<span class="number">0</span> T*T/<span class="number">2</span>;T <span class="number">0</span>;<span class="number">0</span> T];</span><br><span class="line">            obj.Q = obj.Gamma*obj.Gamma&#x27;*<span class="number">1</span>;</span><br><span class="line">            obj.R = <span class="number">1</span>*obj.H*obj.H&#x27;;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">obj</span> = <span class="title">predict</span><span class="params">(obj)</span></span></span><br><span class="line">            obj.x_pre = obj.F*obj.seq(<span class="keyword">end</span>,:)&#x27;;</span><br><span class="line">            obj.P = obj.F*obj.P_k*obj.F&#x27; + obj.Q;</span><br><span class="line"></span><br><span class="line">            obj.z_pre = obj.H*obj.x_pre;</span><br><span class="line">            obj.S = obj.H*obj.P*obj.H&#x27; + obj.R;</span><br><span class="line">            obj.K = obj.P*obj.H&#x27;/(obj.S);</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">obj</span> = <span class="title">addseq</span><span class="params">(obj,Z)</span></span></span><br><span class="line">            obj.x_est = obj.x_pre + obj.K*(Z&#x27; - obj.z_pre);</span><br><span class="line">            obj.P_k = (<span class="built_in">eye</span>(<span class="built_in">size</span>(obj.K*obj.H,<span class="number">1</span>))-obj.K*obj.H)*obj.P;</span><br><span class="line">            </span><br><span class="line">             <span class="comment">% Staging data of 20 points</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">size</span>(obj.seq,<span class="number">1</span>)&lt;<span class="number">20</span></span><br><span class="line">                obj.seq = [obj.seq;obj.x_est&#x27;];</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                obj.seq = [obj.seq;obj.x_est&#x27;];</span><br><span class="line">                obj.seq(<span class="number">1</span>,:) = [];</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">                </span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h2 id="目标跟踪与航迹管理步进函数"><a href="#目标跟踪与航迹管理步进函数" class="headerlink" title="目标跟踪与航迹管理步进函数"></a>目标跟踪与航迹管理步进函数</h2><h3 id="matlab代码"><a href="#matlab代码" class="headerlink" title="matlab代码"></a>matlab代码</h3><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">[Confirmed_trajectory]</span> = <span class="title">Track_step_PNN</span><span class="params">(Measure)</span></span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">persistent</span> test_trajectory;</span><br><span class="line">    <span class="keyword">persistent</span> confirmed_trajectory;</span><br><span class="line">    <span class="keyword">persistent</span> Prev_Measure;</span><br><span class="line">    <span class="keyword">persistent</span> initial_Flag;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isempty</span>(test_trajectory) &amp;&amp; <span class="built_in">isempty</span>(initial_Flag)</span><br><span class="line">        test_trajectory = &#123;&#125;;</span><br><span class="line">        confirmed_trajectory = &#123;&#125;;</span><br><span class="line">        Prev_Measure = [];</span><br><span class="line">        initial_Flag = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">% tracking parameter</span></span><br><span class="line">    DIS_THRE = chi2inv(<span class="number">0.99</span>,<span class="number">2</span>);</span><br><span class="line">    SCOREBOARD_THRE = <span class="number">40</span>;</span><br><span class="line">    N_PARAMETER = <span class="number">6</span>;</span><br><span class="line">    M_PARAMETER = <span class="number">4</span>;</span><br><span class="line">    </span><br><span class="line">    V_MAX = <span class="number">150</span>;</span><br><span class="line">    V_MIN = <span class="number">10</span>;</span><br><span class="line">    T = <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    Measure_temp = Measure;</span><br><span class="line"></span><br><span class="line">    <span class="comment">% MN starter NN association</span></span><br><span class="line">    <span class="keyword">if</span> ~<span class="built_in">isempty</span>(Measure)</span><br><span class="line">        <span class="comment">% associate with ConfirmedTrajectory</span></span><br><span class="line">        <span class="keyword">for</span> kk = <span class="number">1</span>:<span class="built_in">size</span>(confirmed_trajectory,<span class="number">2</span>)</span><br><span class="line">            <span class="keyword">if</span> ~<span class="built_in">isempty</span>(Measure)</span><br><span class="line">                confirmed_trajectory(kk) = confirmed_trajectory(kk).predict();</span><br><span class="line">                temp = confirmed_trajectory(kk).z_pre&#x27;-Measure(:,<span class="number">1</span>:<span class="number">2</span>);</span><br><span class="line">                dis = <span class="built_in">diag</span>(temp*inv(confirmed_trajectory(kk).S)*temp&#x27;);<span class="comment">%计算相邻两帧点迹距离</span></span><br><span class="line"></span><br><span class="line">                [val, pos] = <span class="built_in">min</span>(dis);<span class="comment">%选出距离最小的点</span></span><br><span class="line">                <span class="keyword">if</span> val&lt;DIS_THRE</span><br><span class="line">                    confirmed_trajectory(kk) = confirmed_trajectory(kk).addseq(Measure(pos,:));</span><br><span class="line">                    confirmed_trajectory(kk).scoreboard = <span class="number">0</span>;</span><br><span class="line">                    Measure(pos,:) = [];</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    confirmed_trajectory(kk) = confirmed_trajectory(kk).addseq(confirmed_trajectory(kk).z_pre&#x27;);</span><br><span class="line">                    confirmed_trajectory(kk).scoreboard = confirmed_trajectory(kk).scoreboard + <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">            <span class="comment">% terrible score delete ConfirmedTrajectory</span></span><br><span class="line">            delete_pos = [];</span><br><span class="line">            <span class="keyword">for</span> kk = <span class="number">1</span>:<span class="built_in">size</span>(confirmed_trajectory,<span class="number">2</span>)</span><br><span class="line">                <span class="keyword">if</span> confirmed_trajectory(kk).scoreboard &gt; SCOREBOARD_THRE</span><br><span class="line">                    delete_pos = [delete_pos kk];</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            confirmed_trajectory(delete_pos) = [];</span><br><span class="line"></span><br><span class="line">        <span class="comment">% associate with MNstarter</span></span><br><span class="line">        <span class="keyword">for</span> kk = <span class="number">1</span>:<span class="built_in">size</span>(test_trajectory,<span class="number">2</span>)</span><br><span class="line">            <span class="keyword">if</span> ~<span class="built_in">isempty</span>(Measure)</span><br><span class="line">                test_trajectory(kk) = test_trajectory(kk).predict();</span><br><span class="line">                temp = test_trajectory(kk).z_pre&#x27;-Measure(:,<span class="number">1</span>:<span class="number">2</span>);</span><br><span class="line">                dis = <span class="built_in">diag</span>(temp*inv(test_trajectory(kk).S)*temp&#x27;);<span class="comment">%计算相邻两帧点迹距离</span></span><br><span class="line"></span><br><span class="line">                [val, pos] = <span class="built_in">min</span>(dis);</span><br><span class="line">                <span class="keyword">if</span> val&lt;DIS_THRE</span><br><span class="line">                    test_trajectory(kk) = test_trajectory(kk).addseq(Measure(pos,:));</span><br><span class="line">                    test_trajectory(kk).N = test_trajectory(kk).N + <span class="number">1</span>;</span><br><span class="line">                    test_trajectory(kk).M = test_trajectory(kk).M + <span class="number">1</span>;</span><br><span class="line">                    Measure(pos,:) = [];</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    test_trajectory(kk) = test_trajectory(kk).addseq(test_trajectory(kk).z_pre&#x27;);</span><br><span class="line">                    test_trajectory(kk).N = test_trajectory(kk).N + <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">            <span class="comment">% check whether satisfy MN logic</span></span><br><span class="line">            delete_pos = [];</span><br><span class="line">            <span class="keyword">for</span> kk = <span class="number">1</span>:<span class="built_in">size</span>(test_trajectory,<span class="number">2</span>)</span><br><span class="line">                <span class="keyword">if</span> test_trajectory(kk).N &gt;= N_PARAMETER</span><br><span class="line">                    <span class="keyword">if</span> test_trajectory(kk).M &gt;= M_PARAMETER</span><br><span class="line">                        <span class="comment">% transfer to ConfirmedTrajectory</span></span><br><span class="line">                        confirmed_trajectory = [confirmed_trajectory TestToConfirmed(test_trajectory(kk),T)];</span><br><span class="line">                        <span class="comment">% free MNstarter</span></span><br><span class="line">                        delete_pos = [delete_pos kk];</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                        <span class="comment">% delete MNstarter</span></span><br><span class="line">                        delete_pos = [delete_pos kk];</span><br><span class="line">                    <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            test_trajectory(delete_pos) = [];</span><br><span class="line"></span><br><span class="line">        <span class="comment">% directly start as a new MNstarter</span></span><br><span class="line">        test_trajectory = [test_trajectory directbegin(Measure,Prev_Measure,V_MIN,V_MIN,T)];</span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">        <span class="keyword">for</span> kk = <span class="number">1</span>:<span class="built_in">size</span>(confirmed_trajectory,<span class="number">2</span>)</span><br><span class="line">            <span class="comment">% predict</span></span><br><span class="line">            confirmed_trajectory(kk) = confirmed_trajectory(kk).predict();</span><br><span class="line">            <span class="comment">% use prev point</span></span><br><span class="line">            confirmed_trajectory(kk) = confirmed_trajectory(kk).addseq(confirmed_trajectory(kk).z_pre&#x27;);</span><br><span class="line">            <span class="comment">% ConfirmedTrajectory scoreboard +1</span></span><br><span class="line">            confirmed_trajectory(kk).scoreboard = confirmed_trajectory(kk).scoreboard + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">            <span class="comment">% terrible score delete ConfirmedTrajectory</span></span><br><span class="line">            delete_pos = [];</span><br><span class="line">            <span class="keyword">for</span> kk = <span class="number">1</span>:<span class="built_in">size</span>(confirmed_trajectory,<span class="number">2</span>)</span><br><span class="line">                <span class="keyword">if</span> confirmed_trajectory(kk).scoreboard &gt; SCOREBOARD_THRE</span><br><span class="line">                    delete_pos = [delete_pos kk];</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            confirmed_trajectory(delete_pos) = [];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> kk = <span class="number">1</span>:<span class="built_in">size</span>(test_trajectory,<span class="number">2</span>)</span><br><span class="line">            <span class="comment">% predict</span></span><br><span class="line">            test_trajectory(kk) = test_trajectory(kk).predict();</span><br><span class="line">            <span class="comment">% use prev point</span></span><br><span class="line">            test_trajectory(kk) = test_trajectory(kk).addseq(test_trajectory(kk).z_pre&#x27;);</span><br><span class="line">            <span class="comment">% MNstarter N +1</span></span><br><span class="line">            test_trajectory(kk).N = test_trajectory(kk).N + <span class="number">1</span>;            </span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">            <span class="comment">% check whether satisfy MN logic</span></span><br><span class="line">            delete_pos = [];</span><br><span class="line">            <span class="keyword">for</span> kk = <span class="number">1</span>:<span class="built_in">size</span>(test_trajectory,<span class="number">2</span>)</span><br><span class="line">                <span class="keyword">if</span> test_trajectory(kk).N &gt;= N_PARAMETER</span><br><span class="line">                    <span class="keyword">if</span> test_trajectory(kk).M &gt;= M_PARAMETER</span><br><span class="line">                        <span class="comment">% transfer to ConfirmedTrajectory</span></span><br><span class="line">                        confirmed_trajectory = [confirmed_trajectory TestToConfirmed(test_trajectory(kk),T)];</span><br><span class="line">                        <span class="comment">% free MNstarter</span></span><br><span class="line">                        delete_pos = [delete_pos kk];</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                        <span class="comment">% delete MNstarter</span></span><br><span class="line">                        delete_pos = [delete_pos kk];</span><br><span class="line">                    <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            test_trajectory(delete_pos) = [];</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    Prev_Measure = Measure_temp;</span><br><span class="line">    </span><br><span class="line">    Confirmed_trajectory = confirmed_trajectory;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">[testroot]</span> = <span class="title">directbegin</span><span class="params">(Measure,Prev_Measure,vmin,vmax,T)</span></span></span><br><span class="line">    testroot = MNstarter_KFCV.empty;</span><br><span class="line">    </span><br><span class="line">    index = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> ~<span class="built_in">isempty</span>(Measure)</span><br><span class="line">        <span class="keyword">for</span> <span class="built_in">i</span> = <span class="number">1</span>:<span class="built_in">size</span>(Prev_Measure,<span class="number">1</span>)</span><br><span class="line">            <span class="comment">% calculate distance between two frame </span></span><br><span class="line">            dis = [];</span><br><span class="line">            <span class="keyword">for</span> <span class="built_in">j</span> = <span class="number">1</span>:<span class="built_in">size</span>(Measure,<span class="number">1</span>)</span><br><span class="line">                dis = [dis norm(Prev_Measure(<span class="built_in">i</span>,<span class="number">1</span>:<span class="number">2</span>)-Measure(<span class="built_in">j</span>,<span class="number">1</span>:<span class="number">2</span>))];</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            [val pos] = <span class="built_in">min</span>(dis);</span><br><span class="line">            <span class="keyword">if</span> vmin*T&lt;val&lt;vmax*T</span><br><span class="line">                v = (Measure(pos,:)-Prev_Measure(<span class="built_in">i</span>,:))/T;</span><br><span class="line">                testroot(index) = MNstarter_KFCV([[Prev_Measure(<span class="built_in">i</span>,:) <span class="number">0</span> <span class="number">0</span>];[Measure(pos,:) v]],T);</span><br><span class="line">                index = index +<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">[confirmedroot]</span> = <span class="title">TestToConfirmed</span><span class="params">(testroot,T)</span></span></span><br><span class="line">    confirmedroot = ConfirmTrajectory_KFCV(testroot.seq,T);</span><br><span class="line">    confirmedroot.x_pre = testroot.x_pre;</span><br><span class="line">    confirmedroot.P_k = testroot.P_k;</span><br><span class="line">    confirmedroot.z_pre = testroot.z_pre;</span><br><span class="line">    confirmedroot.P = testroot.P;</span><br><span class="line">    confirmedroot.S = testroot.S;</span><br><span class="line">    confirmedroot.K = testroot.K;</span><br><span class="line">    confirmedroot.x_est = testroot.x_est;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h3 id="python代码"><a href="#python代码" class="headerlink" title="python代码"></a>python代码</h3><h4 id="二维跟踪"><a href="#二维跟踪" class="headerlink" title="二维跟踪"></a>二维跟踪</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># File:         实现逻辑法航迹起始，NN法数据关联，卡尔曼滤波以及传统航迹管理（2维）</span></span><br><span class="line"><span class="comment">#               主要实现了MOT迭代函数</span></span><br><span class="line"><span class="comment"># Author:       UESTC Yu Xuyao</span></span><br><span class="line"><span class="comment"># Email:        yxy19991102@163.com</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> scipy.io <span class="keyword">as</span> scio</span><br><span class="line"><span class="keyword">import</span> numpy</span><br><span class="line"><span class="keyword">import</span> scipy.stats <span class="keyword">as</span> st</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> IWR.track <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2自由度卡方分布</span></span><br><span class="line">threshold = st.chi2.ppf(<span class="number">0.80</span>, <span class="number">2</span>)</span><br><span class="line">T = <span class="number">0.1</span></span><br><span class="line"></span><br><span class="line">F = numpy.mat([[<span class="number">1</span>, <span class="number">0</span>, T, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, T], [<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>]])</span><br><span class="line">H = numpy.mat([[<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>]])</span><br><span class="line">Gamma = numpy.mat([[T * T / <span class="number">2</span>, <span class="number">0</span>], [<span class="number">0</span>, T * T / <span class="number">2</span>], [T, <span class="number">0</span>], [<span class="number">0</span>, T]])</span><br><span class="line">Q = Gamma * Gamma.T * <span class="number">0.5</span></span><br><span class="line">R = <span class="number">0.1</span> * H * H.T</span><br><span class="line"></span><br><span class="line">vmin = <span class="number">0.2</span></span><br><span class="line">vmax = <span class="number">4</span></span><br><span class="line"></span><br><span class="line">max_velocity = <span class="number">1.5</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">beginTrack</span>(<span class="params">points</span>):</span></span><br><span class="line">    <span class="keyword">global</span> threshold, T, F, H, Gamma, Q, R, vmin, vmax</span><br><span class="line"></span><br><span class="line">    outside = []</span><br><span class="line"></span><br><span class="line">    index = <span class="number">0</span></span><br><span class="line">    testroot = []</span><br><span class="line"></span><br><span class="line">    Z_k = (points[<span class="number">0</span>])</span><br><span class="line">    Z_k_plus1 = (points[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, Z_k.shape[<span class="number">1</span>]):</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, Z_k_plus1.shape[<span class="number">1</span>]):</span><br><span class="line">            d = <span class="built_in">max</span>(<span class="number">0</span>, numpy.linalg.norm(Z_k_plus1[:, k] - Z_k[:, j]) - vmax * T) + <span class="built_in">max</span>(<span class="number">0</span>, -numpy.linalg.norm(</span><br><span class="line">                Z_k_plus1[:, k] - Z_k[:, j]) + vmin * T)</span><br><span class="line">            D = d / numpy.linalg.det(R + R) * d</span><br><span class="line">            <span class="keyword">if</span> D &lt;= threshold:</span><br><span class="line">                temp = TestTrack(Z_k[:, j])</span><br><span class="line">                temp.addseq(Z_k_plus1[:, k])</span><br><span class="line"></span><br><span class="line">                Px0 = <span class="number">5</span> * numpy.eye(<span class="number">4</span>)</span><br><span class="line">                P = F * Px0 * F.T + Q</span><br><span class="line">                S = H * P * H.T + R * <span class="number">0.2</span></span><br><span class="line">                K = P * H.T * numpy.linalg.inv(S)</span><br><span class="line">                Pkk = (numpy.eye(<span class="number">4</span>) - K * H) * P</span><br><span class="line"></span><br><span class="line">                x_init = numpy.concatenate((Z_k_plus1[:, k], (Z_k_plus1[:, k] - Z_k[:, j]) / T), axis=<span class="number">0</span>)</span><br><span class="line">                x_forest = F * x_init</span><br><span class="line"></span><br><span class="line">                temp.est = x_init</span><br><span class="line">                temp.pkk = Pkk</span><br><span class="line">                temp.x_predict = x_forest</span><br><span class="line">                temp.M = <span class="number">2</span></span><br><span class="line">                temp.N = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">                testroot.append(temp)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> testroot</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">TestToConfirmed</span>(<span class="params">testroot</span>):</span></span><br><span class="line">    confirmedroot = ConfirmedTrack(testroot.start)</span><br><span class="line">    confirmedroot.seq = testroot.seq</span><br><span class="line">    confirmedroot.est = testroot.est</span><br><span class="line">    confirmedroot.pkk = testroot.pkk</span><br><span class="line">    confirmedroot.seq = testroot.seq</span><br><span class="line">    confirmedroot.x_predict = testroot.x_predict</span><br><span class="line">    <span class="keyword">return</span> confirmedroot</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">MOT</span>(<span class="params">Z_k, Z_k_prev, confirmedroot, testroot</span>):</span></span><br><span class="line">    <span class="keyword">global</span> threshold, T, F, H, Gamma, Q, R, vmin, vmax</span><br><span class="line"></span><br><span class="line">    Z_k_present = Z_k</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> Z_k.shape[<span class="number">1</span>] == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(confirmedroot) != <span class="number">0</span>:</span><br><span class="line">            pos = []</span><br><span class="line">            <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(confirmedroot)):</span><br><span class="line">                confirmedroot[kk].board += <span class="number">1</span></span><br><span class="line">                <span class="keyword">if</span> confirmedroot[kk].board &gt;= <span class="number">4</span>:</span><br><span class="line">                    pos.append(kk)</span><br><span class="line">            confirmedroot = numpy.delete(confirmedroot, pos)</span><br><span class="line">            confirmedroot = confirmedroot.tolist()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> Z_k.shape[<span class="number">1</span>] != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(confirmedroot) != <span class="number">0</span>:</span><br><span class="line">            pos = []</span><br><span class="line">            <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(confirmedroot)):</span><br><span class="line">                <span class="keyword">if</span> Z_k.shape[<span class="number">1</span>] == <span class="number">0</span>:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">                P = F * confirmedroot[kk].pkk * F.T + Q</span><br><span class="line">                S = H * P * H.T + R</span><br><span class="line">                K = P * H.T * numpy.linalg.inv(S)</span><br><span class="line">                outside = H * confirmedroot[kk].x_predict</span><br><span class="line">                V = []</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, Z_k.shape[<span class="number">1</span>]):</span><br><span class="line">                    V.append((Z_k[:, i] - outside).T * numpy.linalg.inv(S) * (Z_k[:, i] - outside))</span><br><span class="line"></span><br><span class="line">                index = numpy.argmin(V)</span><br><span class="line">                val = numpy.amin(V)</span><br><span class="line">                <span class="keyword">if</span> val &lt;= threshold:</span><br><span class="line">                    confirmedroot[kk].addseq(Z_k[:, index])</span><br><span class="line">                    est = confirmedroot[kk].x_predict + K * (Z_k[:, index] - outside)</span><br><span class="line">                    confirmedroot[kk].addest(est)</span><br><span class="line">                    confirmedroot[kk].pkk = (numpy.eye(<span class="number">4</span>) - K * H) * P</span><br><span class="line">                    confirmedroot[kk].x_predict = F * est</span><br><span class="line">                    confirmedroot[kk].board = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">                    Z_k = numpy.delete(Z_k, index, axis=<span class="number">1</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    confirmedroot[kk].addseq(outside)</span><br><span class="line">                    confirmedroot[kk].addest(confirmedroot[kk].x_predict)</span><br><span class="line">                    confirmedroot[kk].pkk = P</span><br><span class="line">                    confirmedroot[kk].x_predict = F * confirmedroot[kk].est[:, -<span class="number">1</span>]</span><br><span class="line">                    confirmedroot[kk].board += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> confirmedroot[kk].board &gt;= <span class="number">4</span> <span class="keyword">or</span> numpy.linalg.norm(confirmedroot[kk].est[<span class="number">2</span>:<span class="number">4</span>, -<span class="number">1</span>]) &gt; max_velocity:</span><br><span class="line">                    pos.append(kk)</span><br><span class="line"></span><br><span class="line">            confirmedroot = numpy.delete(confirmedroot, pos)</span><br><span class="line">            confirmedroot = confirmedroot.tolist()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> Z_k.shape[<span class="number">1</span>] != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(testroot) != <span class="number">0</span>:</span><br><span class="line">            pos = []</span><br><span class="line">            <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(testroot)):</span><br><span class="line">                <span class="keyword">if</span> Z_k.shape[<span class="number">1</span>] == <span class="number">0</span>:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">                P = F * testroot[kk].pkk * F.T + Q</span><br><span class="line">                S = H * P * H.T + R</span><br><span class="line">                K = P * H.T * numpy.linalg.inv(S)</span><br><span class="line">                outside = H * testroot[kk].x_predict</span><br><span class="line">                V = []</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, Z_k.shape[<span class="number">1</span>]):</span><br><span class="line">                    V.append((Z_k[:, i] - outside).T * numpy.linalg.inv(S) * (Z_k[:, i] - outside))</span><br><span class="line"></span><br><span class="line">                index = numpy.argmin(V)</span><br><span class="line">                val = numpy.amin(V)</span><br><span class="line">                <span class="keyword">if</span> val &lt;= threshold:</span><br><span class="line">                    testroot[kk].addseq(Z_k[:, index])</span><br><span class="line">                    est = testroot[kk].x_predict + K * (Z_k[:, index] - outside)</span><br><span class="line">                    testroot[kk].addest(est)</span><br><span class="line">                    testroot[kk].pkk = (numpy.eye(<span class="number">4</span>) - K * H) * P</span><br><span class="line">                    testroot[kk].x_predict = F * est</span><br><span class="line">                    testroot[kk].M += <span class="number">1</span></span><br><span class="line">                    testroot[kk].N += <span class="number">1</span></span><br><span class="line">                    Z_k = numpy.delete(Z_k, index, axis=<span class="number">1</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    testroot[kk].addseq(outside)</span><br><span class="line">                    testroot[kk].addest(testroot[kk].x_predict)</span><br><span class="line">                    testroot[kk].pkk = P</span><br><span class="line">                    testroot[kk].x_predict = F * testroot[kk].est[:, -<span class="number">1</span>]</span><br><span class="line">                    testroot[kk].N += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> testroot[kk].N == <span class="number">6</span>:</span><br><span class="line">                    <span class="keyword">if</span> testroot[kk].M &gt;= <span class="number">4</span> <span class="keyword">and</span> numpy.linalg.norm(testroot[kk].est[<span class="number">2</span>:<span class="number">4</span>, -<span class="number">1</span>]) &lt; max_velocity:</span><br><span class="line">                        confirmedroot.append(TestToConfirmed(testroot[kk]))</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        pos.append(kk)</span><br><span class="line"></span><br><span class="line">            testroot = numpy.delete(testroot, pos)</span><br><span class="line">            testroot = testroot.tolist()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> Z_k.shape[<span class="number">1</span>] != <span class="number">0</span>:</span><br><span class="line">        testroot.extend(beginTrack([Z_k_prev, Z_k_present]))</span><br><span class="line"></span><br><span class="line">    Z_k_prev = Z_k_present</span><br><span class="line">    <span class="keyword">return</span> confirmedroot, testroot, Z_k_present</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="三维跟踪"><a href="#三维跟踪" class="headerlink" title="三维跟踪"></a>三维跟踪</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># File:         实现逻辑法航迹起始，NN法数据关联，卡尔曼滤波以及传统航迹管理（3维）</span></span><br><span class="line"><span class="comment">#               主要实现了MOT迭代函数</span></span><br><span class="line"><span class="comment"># Author:       UESTC YuXuyao</span></span><br><span class="line"><span class="comment"># Email:        yxy19991102@163.com</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> scipy.io <span class="keyword">as</span> scio</span><br><span class="line"><span class="keyword">import</span> numpy</span><br><span class="line"><span class="keyword">import</span> scipy.stats <span class="keyword">as</span> st</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> IWR.track <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">threshold = st.chi2.ppf(<span class="number">0.80</span>, <span class="number">3</span>)</span><br><span class="line">T = <span class="number">0.1</span></span><br><span class="line"></span><br><span class="line">F = numpy.mat([[<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, T, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, T, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, T], [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>],</span><br><span class="line">               [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>]])</span><br><span class="line">H = numpy.mat([[<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]])</span><br><span class="line">Gamma = numpy.mat([[T * T / <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">0</span>, T * T / <span class="number">2</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">0</span>, T * T / <span class="number">2</span>], [T, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">0</span>, T, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">0</span>, T]])</span><br><span class="line">Q = Gamma * Gamma.T * <span class="number">0.5</span></span><br><span class="line">R = <span class="number">0.1</span> * H * H.T</span><br><span class="line"></span><br><span class="line">vmin = <span class="number">0.2</span></span><br><span class="line">vmax = <span class="number">4</span></span><br><span class="line"></span><br><span class="line">max_velocity = <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">beginTrack</span>(<span class="params">points</span>):</span></span><br><span class="line">    <span class="keyword">global</span> threshold, T, F, H, Gamma, Q, R, vmin, vmax</span><br><span class="line"></span><br><span class="line">    outside = []</span><br><span class="line"></span><br><span class="line">    index = <span class="number">0</span></span><br><span class="line">    testroot = []</span><br><span class="line"></span><br><span class="line">    Z_k = (points[<span class="number">0</span>])</span><br><span class="line">    Z_k_plus1 = (points[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, Z_k.shape[<span class="number">1</span>]):</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, Z_k_plus1.shape[<span class="number">1</span>]):</span><br><span class="line">            d = <span class="built_in">max</span>(<span class="number">0</span>, numpy.linalg.norm(Z_k_plus1[:, k] - Z_k[:, j]) - vmax * T) + <span class="built_in">max</span>(<span class="number">0</span>, -numpy.linalg.norm(</span><br><span class="line">                Z_k_plus1[:, k] - Z_k[:, j]) + vmin * T)</span><br><span class="line">            D = d / numpy.linalg.det(R + R) * d</span><br><span class="line">            <span class="keyword">if</span> D &lt;= threshold:</span><br><span class="line">                temp = TestTrack(Z_k[:, j])</span><br><span class="line">                temp.addseq(Z_k_plus1[:, k])</span><br><span class="line"></span><br><span class="line">                Px0 = <span class="number">5</span> * numpy.eye(<span class="number">6</span>)</span><br><span class="line">                P = F * Px0 * F.T + Q</span><br><span class="line">                S = H * P * H.T + R * <span class="number">0.2</span></span><br><span class="line">                K = P * H.T * numpy.linalg.inv(S)</span><br><span class="line">                Pkk = (numpy.eye(<span class="number">6</span>) - K * H) * P</span><br><span class="line"></span><br><span class="line">                x_init = numpy.concatenate((Z_k_plus1[:, k], (Z_k_plus1[:, k] - Z_k[:, j]) / T), axis=<span class="number">0</span>)</span><br><span class="line">                x_forest = F * x_init</span><br><span class="line"></span><br><span class="line">                temp.est = x_init</span><br><span class="line">                temp.pkk = Pkk</span><br><span class="line">                temp.x_predict = x_forest</span><br><span class="line">                temp.M = <span class="number">2</span></span><br><span class="line">                temp.N = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">                testroot.append(temp)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> testroot</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">TestToConfirmed</span>(<span class="params">testroot</span>):</span></span><br><span class="line">    confirmedroot = ConfirmedTrack(testroot.start)</span><br><span class="line">    confirmedroot.seq = testroot.seq</span><br><span class="line">    confirmedroot.est = testroot.est</span><br><span class="line">    confirmedroot.pkk = testroot.pkk</span><br><span class="line">    confirmedroot.seq = testroot.seq</span><br><span class="line">    confirmedroot.x_predict = testroot.x_predict</span><br><span class="line">    <span class="keyword">return</span> confirmedroot</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">MOT</span>(<span class="params">Z_k, Z_k_prev, confirmedroot, testroot</span>):</span></span><br><span class="line">    <span class="keyword">global</span> threshold, T, F, H, Gamma, Q, R, vmin, vmax</span><br><span class="line"></span><br><span class="line">    Z_k_present = Z_k</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> Z_k.shape[<span class="number">1</span>] == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(confirmedroot) != <span class="number">0</span>:</span><br><span class="line">            pos = []</span><br><span class="line">            <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(confirmedroot)):</span><br><span class="line">                confirmedroot[kk].board += <span class="number">1</span></span><br><span class="line">                <span class="keyword">if</span> confirmedroot[kk].board &gt;= <span class="number">4</span>:</span><br><span class="line">                    pos.append(kk)</span><br><span class="line">            confirmedroot = numpy.delete(confirmedroot, pos)</span><br><span class="line">            confirmedroot = confirmedroot.tolist()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> Z_k.shape[<span class="number">1</span>] != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(confirmedroot) != <span class="number">0</span>:</span><br><span class="line">            pos = []</span><br><span class="line">            <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(confirmedroot)):</span><br><span class="line">                <span class="keyword">if</span> Z_k.shape[<span class="number">1</span>] == <span class="number">0</span>:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">                P = F * confirmedroot[kk].pkk * F.T + Q</span><br><span class="line">                S = H * P * H.T + R</span><br><span class="line">                K = P * H.T * numpy.linalg.inv(S)</span><br><span class="line">                outside = H * confirmedroot[kk].x_predict</span><br><span class="line">                V = []</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, Z_k.shape[<span class="number">1</span>]):</span><br><span class="line">                    V.append((Z_k[:, i] - outside).T * numpy.linalg.inv(S) * (Z_k[:, i] - outside))</span><br><span class="line"></span><br><span class="line">                index = numpy.argmin(V)</span><br><span class="line">                val = numpy.amin(V)</span><br><span class="line">                <span class="keyword">if</span> val &lt;= threshold:</span><br><span class="line">                    confirmedroot[kk].addseq(Z_k[:, index])</span><br><span class="line">                    est = confirmedroot[kk].x_predict + K * (Z_k[:, index] - outside)</span><br><span class="line">                    confirmedroot[kk].addest(est)</span><br><span class="line">                    confirmedroot[kk].pkk = (numpy.eye(<span class="number">6</span>) - K * H) * P</span><br><span class="line">                    confirmedroot[kk].x_predict = F * est</span><br><span class="line">                    confirmedroot[kk].board = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">                    Z_k = numpy.delete(Z_k, index, axis=<span class="number">1</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    confirmedroot[kk].addseq(outside)</span><br><span class="line">                    confirmedroot[kk].addest(confirmedroot[kk].x_predict)</span><br><span class="line">                    confirmedroot[kk].pkk = P</span><br><span class="line">                    confirmedroot[kk].x_predict = F * confirmedroot[kk].est[:, -<span class="number">1</span>]</span><br><span class="line">                    confirmedroot[kk].board += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> confirmedroot[kk].board &gt;= <span class="number">4</span> <span class="keyword">or</span> numpy.linalg.norm(confirmedroot[kk].est[<span class="number">3</span>:<span class="number">6</span>, -<span class="number">1</span>]) &gt; max_velocity:</span><br><span class="line">                    pos.append(kk)</span><br><span class="line"></span><br><span class="line">            confirmedroot = numpy.delete(confirmedroot, pos)</span><br><span class="line">            confirmedroot = confirmedroot.tolist()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> Z_k.shape[<span class="number">1</span>] != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(testroot) != <span class="number">0</span>:</span><br><span class="line">            pos = []</span><br><span class="line">            <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(testroot)):</span><br><span class="line">                <span class="keyword">if</span> Z_k.shape[<span class="number">1</span>] == <span class="number">0</span>:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">                P = F * testroot[kk].pkk * F.T + Q</span><br><span class="line">                S = H * P * H.T + R</span><br><span class="line">                K = P * H.T * numpy.linalg.inv(S)</span><br><span class="line">                outside = H * testroot[kk].x_predict</span><br><span class="line">                V = []</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, Z_k.shape[<span class="number">1</span>]):</span><br><span class="line">                    V.append((Z_k[:, i] - outside).T * numpy.linalg.inv(S) * (Z_k[:, i] - outside))</span><br><span class="line"></span><br><span class="line">                index = numpy.argmin(V)</span><br><span class="line">                val = numpy.amin(V)</span><br><span class="line">                <span class="keyword">if</span> val &lt;= threshold:</span><br><span class="line">                    testroot[kk].addseq(Z_k[:, index])</span><br><span class="line">                    est = testroot[kk].x_predict + K * (Z_k[:, index] - outside)</span><br><span class="line">                    testroot[kk].addest(est)</span><br><span class="line">                    testroot[kk].pkk = (numpy.eye(<span class="number">6</span>) - K * H) * P</span><br><span class="line">                    testroot[kk].x_predict = F * est</span><br><span class="line">                    testroot[kk].M += <span class="number">1</span></span><br><span class="line">                    testroot[kk].N += <span class="number">1</span></span><br><span class="line">                    Z_k = numpy.delete(Z_k, index, axis=<span class="number">1</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    testroot[kk].addseq(outside)</span><br><span class="line">                    testroot[kk].addest(testroot[kk].x_predict)</span><br><span class="line">                    testroot[kk].pkk = P</span><br><span class="line">                    testroot[kk].x_predict = F * testroot[kk].est[:, -<span class="number">1</span>]</span><br><span class="line">                    testroot[kk].N += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> testroot[kk].N == <span class="number">6</span>:</span><br><span class="line">                    <span class="keyword">if</span> testroot[kk].M &gt;= <span class="number">4</span> <span class="keyword">and</span> numpy.linalg.norm(testroot[kk].est[<span class="number">3</span>:<span class="number">6</span>, -<span class="number">1</span>]) &lt; max_velocity:</span><br><span class="line">                        confirmedroot.append(TestToConfirmed(testroot[kk]))</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        pos.append(kk)</span><br><span class="line"></span><br><span class="line">            testroot = numpy.delete(testroot, pos)</span><br><span class="line">            testroot = testroot.tolist()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> Z_k.shape[<span class="number">1</span>] != <span class="number">0</span>:</span><br><span class="line">        testroot.extend(beginTrack([Z_k_prev, Z_k_present]))</span><br><span class="line"></span><br><span class="line">    Z_k_prev = Z_k_present</span><br><span class="line">    <span class="keyword">return</span> confirmedroot, testroot, Z_k_present</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="目标跟踪与航迹管理实例脚本"><a href="#目标跟踪与航迹管理实例脚本" class="headerlink" title="目标跟踪与航迹管理实例脚本"></a>目标跟踪与航迹管理实例脚本</h2><h3 id="matlab示例"><a href="#matlab示例" class="headerlink" title="matlab示例"></a>matlab示例</h3><p>其中 measure.mat 是由CFAR检测得到的每一帧检测点的集合<br><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">clear all</span><br><span class="line">close all</span><br><span class="line">clc</span><br><span class="line"></span><br><span class="line">load(<span class="string">&#x27;measure.mat&#x27;</span>);</span><br><span class="line"><span class="built_in">figure</span></span><br><span class="line"><span class="built_in">hold</span> on </span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span> = <span class="number">1</span>:<span class="built_in">size</span>(measure,<span class="number">2</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">hold</span> off</span><br><span class="line">    <span class="built_in">plot</span>(<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">    axis([<span class="number">0</span> <span class="number">4000</span> <span class="number">-4000</span> <span class="number">4000</span>]);</span><br><span class="line">    <span class="built_in">hold</span> on</span><br><span class="line">    [Confirmed_trajectory] = Track_step_PNN(measure&#123;<span class="built_in">i</span>&#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">j</span> = <span class="number">1</span>:<span class="built_in">size</span>(Confirmed_trajectory,<span class="number">2</span>)</span><br><span class="line">        <span class="built_in">plot</span>(Confirmed_trajectory(<span class="built_in">j</span>).seq(:,<span class="number">1</span>),Confirmed_trajectory(<span class="built_in">j</span>).seq(:,<span class="number">2</span>),<span class="string">&#x27;-o&#x27;</span>,<span class="string">&#x27;linewidth&#x27;</span>,<span class="number">1</span>);</span><br><span class="line">        axis([<span class="number">0</span> <span class="number">4000</span> <span class="number">-4000</span> <span class="number">4000</span>]);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line">    pause(<span class="number">0.1</span>);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p>
<h3 id="python示例"><a href="#python示例" class="headerlink" title="python示例"></a>python示例</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># File:         读取IWR6843处理得到的点云数据（3维）进行目标跟踪，同时调用openGL对第一个航迹进行显示（多个显示未完成）</span></span><br><span class="line"><span class="comment"># Author:       UESTC Yu Xuyao</span></span><br><span class="line"><span class="comment"># Email:        yxy19991102@163.com</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> serial</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pyqtgraph <span class="keyword">as</span> pg</span><br><span class="line"><span class="keyword">from</span> pyqtgraph.Qt <span class="keyword">import</span> QtGui</span><br><span class="line"><span class="keyword">import</span> pyqtgraph.opengl <span class="keyword">as</span> gl</span><br><span class="line"><span class="keyword">from</span> IWR.MOT3D <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> numpy</span><br><span class="line"><span class="keyword">from</span> sklearn.cluster <span class="keyword">import</span> dbscan</span><br><span class="line"><span class="keyword">import</span> pandas</span><br><span class="line"></span><br><span class="line"><span class="comment"># Change the configuration file name</span></span><br><span class="line">configFileName = <span class="string">&#x27;profile_iwr6843_ods_3d.cfg&#x27;</span></span><br><span class="line"></span><br><span class="line">CLIport = &#123;&#125;</span><br><span class="line">Dataport = &#123;&#125;</span><br><span class="line">byteBuffer = np.zeros(<span class="number">2</span> ** <span class="number">15</span>, dtype=<span class="string">&#x27;uint8&#x27;</span>)</span><br><span class="line">byteBufferLength = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">testroot = []</span><br><span class="line">confirmedroot = []</span><br><span class="line">Z_k_prev = numpy.mat([])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Function to configure the serial ports and send the data from</span></span><br><span class="line"><span class="comment"># the configuration file to the radar</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">serialConfig</span>(<span class="params">configFileName</span>):</span></span><br><span class="line">    <span class="keyword">global</span> CLIport</span><br><span class="line">    <span class="keyword">global</span> Dataport</span><br><span class="line">    <span class="comment"># Open the serial ports for the configuration and the data ports</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Linux</span></span><br><span class="line">    <span class="comment"># CLIport = serial.Serial(&#x27;/dev/ttyACM0&#x27;, 115200)</span></span><br><span class="line">    <span class="comment"># Dataport = serial.Serial(&#x27;/dev/ttyACM1&#x27;, 921600)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Windows</span></span><br><span class="line">    CLIport = serial.Serial(<span class="string">&#x27;COM7&#x27;</span>, <span class="number">115200</span>)</span><br><span class="line">    Dataport = serial.Serial(<span class="string">&#x27;COM8&#x27;</span>, <span class="number">921600</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Read the configuration file and send it to the board</span></span><br><span class="line">    config = [line.rstrip(<span class="string">&#x27;\r\n&#x27;</span>) <span class="keyword">for</span> line <span class="keyword">in</span> <span class="built_in">open</span>(configFileName)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> config:</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">        CLIport.write((i + <span class="string">&#x27;\n&#x27;</span>).encode())</span><br><span class="line">        <span class="comment"># wait for reply</span></span><br><span class="line">        time.sleep(<span class="number">0.1</span>)</span><br><span class="line">        reply = CLIport.read(CLIport.in_waiting).decode()</span><br><span class="line">        <span class="built_in">print</span>(reply)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> CLIport, Dataport</span><br><span class="line"></span><br><span class="line"><span class="comment"># ------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Funtion to read and parse the incoming data</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">readAndParseData</span>(<span class="params">Dataport</span>):</span></span><br><span class="line">    <span class="keyword">global</span> byteBuffer, byteBufferLength</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Constants</span></span><br><span class="line">    OBJ_STRUCT_SIZE_BYTES = <span class="number">12</span></span><br><span class="line">    BYTE_VEC_ACC_MAX_SIZE = <span class="number">2</span> ** <span class="number">15</span></span><br><span class="line">    MMWDEMO_UART_MSG_DETECTED_POINTS = <span class="number">1</span></span><br><span class="line">    MMWDEMO_UART_MSG_RANGE_PROFILE = <span class="number">2</span></span><br><span class="line">    maxBufferSize = <span class="number">2</span> ** <span class="number">15</span></span><br><span class="line">    tlvHeaderLengthInBytes = <span class="number">8</span></span><br><span class="line">    pointLengthInBytes = <span class="number">16</span></span><br><span class="line">    magicWord = [<span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">7</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Initialize variables</span></span><br><span class="line">    magicOK = <span class="number">0</span>  <span class="comment"># Checks if magic number has been read</span></span><br><span class="line">    dataOK = <span class="number">0</span>  <span class="comment"># Checks if the data has been read correctly</span></span><br><span class="line">    frameNumber = <span class="number">0</span></span><br><span class="line">    detObj = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    readBuffer = Dataport.read(Dataport.in_waiting)</span><br><span class="line">    byteVec = np.frombuffer(readBuffer, dtype=<span class="string">&#x27;uint8&#x27;</span>)</span><br><span class="line">    byteCount = <span class="built_in">len</span>(byteVec)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Check that the buffer is not full, and then add the data to the buffer</span></span><br><span class="line">    <span class="keyword">if</span> (byteBufferLength + byteCount) &lt; maxBufferSize:</span><br><span class="line">        byteBuffer[byteBufferLength:(byteBufferLength + byteCount)] = byteVec[<span class="number">0</span>:byteCount]</span><br><span class="line">        byteBufferLength = byteBufferLength + byteCount</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Check that the buffer has some data</span></span><br><span class="line">    <span class="keyword">if</span> byteBufferLength &gt; <span class="number">16</span>:</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Check for all possible locations of the magic word</span></span><br><span class="line">        possibleLocs = np.where(byteBuffer == magicWord[<span class="number">0</span>])[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Confirm that is the beginning of the magic word and store the index in startIdx</span></span><br><span class="line">        startIdx = []</span><br><span class="line">        <span class="keyword">for</span> loc <span class="keyword">in</span> possibleLocs:</span><br><span class="line">            check = byteBuffer[loc:loc + <span class="number">8</span>]</span><br><span class="line">            <span class="keyword">if</span> np.<span class="built_in">all</span>(check == magicWord):</span><br><span class="line">                startIdx.append(loc)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Check that startIdx is not empty</span></span><br><span class="line">        <span class="keyword">if</span> startIdx:</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Remove the data before the first start index</span></span><br><span class="line">            <span class="keyword">if</span> <span class="number">0</span> &lt; startIdx[<span class="number">0</span>] &lt; byteBufferLength:</span><br><span class="line">                byteBuffer[:byteBufferLength - startIdx[<span class="number">0</span>]] = byteBuffer[startIdx[<span class="number">0</span>]:byteBufferLength]</span><br><span class="line">                byteBuffer[byteBufferLength - startIdx[<span class="number">0</span>]:] = np.zeros(<span class="built_in">len</span>(byteBuffer[byteBufferLength - startIdx[<span class="number">0</span>]:]),</span><br><span class="line">                                                                       dtype=<span class="string">&#x27;uint8&#x27;</span>)</span><br><span class="line">                byteBufferLength = byteBufferLength - startIdx[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Check that there have no errors with the byte buffer length</span></span><br><span class="line">            <span class="keyword">if</span> byteBufferLength &lt; <span class="number">0</span>:</span><br><span class="line">                byteBufferLength = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># Read the total packet length</span></span><br><span class="line">            totalPacketLen = <span class="built_in">int</span>.from_bytes(byteBuffer[<span class="number">12</span>:<span class="number">12</span> + <span class="number">4</span>], byteorder=<span class="string">&#x27;little&#x27;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Check that all the packet has been read</span></span><br><span class="line">            <span class="keyword">if</span> (byteBufferLength &gt;= totalPacketLen) <span class="keyword">and</span> (byteBufferLength != <span class="number">0</span>):</span><br><span class="line">                magicOK = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># If magicOK is equal to 1 then process the message</span></span><br><span class="line">    <span class="keyword">if</span> magicOK:</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Initialize the pointer index</span></span><br><span class="line">        idX = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Read the header</span></span><br><span class="line">        magicNumber = byteBuffer[idX:idX + <span class="number">8</span>]</span><br><span class="line">        idX += <span class="number">8</span></span><br><span class="line">        version = <span class="built_in">format</span>(<span class="built_in">int</span>.from_bytes(byteBuffer[idX:idX + <span class="number">4</span>], byteorder=<span class="string">&#x27;little&#x27;</span>), <span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">        idX += <span class="number">4</span></span><br><span class="line">        totalPacketLen = <span class="built_in">int</span>.from_bytes(byteBuffer[idX:idX + <span class="number">4</span>], byteorder=<span class="string">&#x27;little&#x27;</span>)</span><br><span class="line">        idX += <span class="number">4</span></span><br><span class="line">        platform = <span class="built_in">format</span>(<span class="built_in">int</span>.from_bytes(byteBuffer[idX:idX + <span class="number">4</span>], byteorder=<span class="string">&#x27;little&#x27;</span>), <span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">        idX += <span class="number">4</span></span><br><span class="line">        frameNumber = <span class="built_in">int</span>.from_bytes(byteBuffer[idX:idX + <span class="number">4</span>], byteorder=<span class="string">&#x27;little&#x27;</span>)</span><br><span class="line">        idX += <span class="number">4</span></span><br><span class="line">        timeCpuCycles = <span class="built_in">int</span>.from_bytes(byteBuffer[idX:idX + <span class="number">4</span>], byteorder=<span class="string">&#x27;little&#x27;</span>)</span><br><span class="line">        idX += <span class="number">4</span></span><br><span class="line">        numDetectedObj = <span class="built_in">int</span>.from_bytes(byteBuffer[idX:idX + <span class="number">4</span>], byteorder=<span class="string">&#x27;little&#x27;</span>)</span><br><span class="line">        idX += <span class="number">4</span></span><br><span class="line">        numTLVs = <span class="built_in">int</span>.from_bytes(byteBuffer[idX:idX + <span class="number">4</span>], byteorder=<span class="string">&#x27;little&#x27;</span>)</span><br><span class="line">        idX += <span class="number">4</span></span><br><span class="line">        subFrameNumber = <span class="built_in">int</span>.from_bytes(byteBuffer[idX:idX + <span class="number">4</span>], byteorder=<span class="string">&#x27;little&#x27;</span>)</span><br><span class="line">        idX += <span class="number">4</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Read the TLV messages</span></span><br><span class="line">        <span class="keyword">for</span> tlvIdx <span class="keyword">in</span> <span class="built_in">range</span>(numTLVs):</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Check the header of the TLV message</span></span><br><span class="line">            tlv_type = <span class="built_in">int</span>.from_bytes(byteBuffer[idX:idX + <span class="number">4</span>], byteorder=<span class="string">&#x27;little&#x27;</span>)</span><br><span class="line">            idX += <span class="number">4</span></span><br><span class="line">            tlv_length = <span class="built_in">int</span>.from_bytes(byteBuffer[idX:idX + <span class="number">4</span>], byteorder=<span class="string">&#x27;little&#x27;</span>)</span><br><span class="line">            idX += <span class="number">4</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># Read the data depending on the TLV message</span></span><br><span class="line">            <span class="keyword">if</span> tlv_type == MMWDEMO_UART_MSG_DETECTED_POINTS:</span><br><span class="line"></span><br><span class="line">                <span class="comment"># Initialize the arrays</span></span><br><span class="line">                x = np.zeros(numDetectedObj, dtype=np.float32)</span><br><span class="line">                y = np.zeros(numDetectedObj, dtype=np.float32)</span><br><span class="line">                z = np.zeros(numDetectedObj, dtype=np.float32)</span><br><span class="line">                velocity = np.zeros(numDetectedObj, dtype=np.float32)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">for</span> objectNum <span class="keyword">in</span> <span class="built_in">range</span>(numDetectedObj):</span><br><span class="line">                    <span class="comment"># Read the data for each object</span></span><br><span class="line">                    x[objectNum] = byteBuffer[idX:idX + <span class="number">4</span>].view(dtype=np.float32)</span><br><span class="line">                    idX += <span class="number">4</span></span><br><span class="line">                    y[objectNum] = byteBuffer[idX:idX + <span class="number">4</span>].view(dtype=np.float32)</span><br><span class="line">                    idX += <span class="number">4</span></span><br><span class="line">                    z[objectNum] = byteBuffer[idX:idX + <span class="number">4</span>].view(dtype=np.float32)</span><br><span class="line">                    idX += <span class="number">4</span></span><br><span class="line">                    velocity[objectNum] = byteBuffer[idX:idX + <span class="number">4</span>].view(dtype=np.float32)</span><br><span class="line">                    idX += <span class="number">4</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># Store the data in the detObj dictionary</span></span><br><span class="line">                detObj = &#123;<span class="string">&quot;numObj&quot;</span>: numDetectedObj, <span class="string">&quot;x&quot;</span>: x, <span class="string">&quot;y&quot;</span>: y, <span class="string">&quot;z&quot;</span>: z, <span class="string">&quot;velocity&quot;</span>: velocity&#125;</span><br><span class="line">                dataOK = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Remove already processed data</span></span><br><span class="line">        <span class="keyword">if</span> <span class="number">0</span> &lt; idX &lt; byteBufferLength:</span><br><span class="line">            shiftSize = totalPacketLen</span><br><span class="line"></span><br><span class="line">            byteBuffer[:byteBufferLength - shiftSize] = byteBuffer[shiftSize:byteBufferLength]</span><br><span class="line">            byteBuffer[byteBufferLength - shiftSize:] = np.zeros(<span class="built_in">len</span>(byteBuffer[byteBufferLength - shiftSize:]),</span><br><span class="line">                                                                 dtype=<span class="string">&#x27;uint8&#x27;</span>)</span><br><span class="line">            byteBufferLength = byteBufferLength - shiftSize</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Check that there are no errors with the buffer length</span></span><br><span class="line">            <span class="keyword">if</span> byteBufferLength &lt; <span class="number">0</span>:</span><br><span class="line">                byteBufferLength = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> dataOK, frameNumber, detObj</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Funtion to update the data and display in the plot</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">update</span>():</span></span><br><span class="line">    dataOk = <span class="number">0</span></span><br><span class="line">    <span class="keyword">global</span> detObj, confirmedroot, testroot, Z_k_prev, LinePlot</span><br><span class="line">    x = []</span><br><span class="line">    y = []</span><br><span class="line">    z = []</span><br><span class="line">    <span class="comment"># Read and parse the received data</span></span><br><span class="line">    dataOk, frameNumber, detObj = readAndParseData(Dataport)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> dataOk:</span><br><span class="line">        x = detObj[<span class="string">&quot;x&quot;</span>]</span><br><span class="line">        y = detObj[<span class="string">&quot;y&quot;</span>]</span><br><span class="line">        z = detObj[<span class="string">&quot;z&quot;</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(x) != <span class="number">0</span>:</span><br><span class="line">            core_samples, cluster_ids = dbscan(np.vstack((x, y, z)).T, eps=<span class="number">0.3</span>, min_samples=<span class="number">3</span>)</span><br><span class="line">            df = pandas.DataFrame(np.c_[np.vstack((x, y, z)).T, cluster_ids],</span><br><span class="line">                                  columns=[<span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;z&#x27;</span>, <span class="string">&#x27;cluster_id&#x27;</span>])</span><br><span class="line">            df = df[df.cluster_id != -<span class="number">1</span>]</span><br><span class="line">            count = df[<span class="string">&#x27;cluster_id&#x27;</span>].value_counts()</span><br><span class="line"></span><br><span class="line">            x = []</span><br><span class="line">            y = []</span><br><span class="line">            z = []</span><br><span class="line">            <span class="keyword">if</span> count.shape[<span class="number">0</span>] &gt;= <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, count.shape[<span class="number">0</span>]):</span><br><span class="line">                    df1 = df[df.cluster_id == i]</span><br><span class="line">                    mean = np.mean([df1[<span class="string">&#x27;x&#x27;</span>], df1[<span class="string">&#x27;y&#x27;</span>], df1[<span class="string">&#x27;z&#x27;</span>]], <span class="number">1</span>)</span><br><span class="line">                    x.append(mean[<span class="number">0</span>])</span><br><span class="line">                    y.append(mean[<span class="number">1</span>])</span><br><span class="line">                    z.append(mean[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line">        Z_k = numpy.mat([x, y, z])</span><br><span class="line"></span><br><span class="line">        confirmedroot, testroot, Z_k_prev = MOT(Z_k, Z_k_prev, confirmedroot, testroot)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(confirmedroot) &gt; <span class="number">0</span>:</span><br><span class="line">            tmppos = confirmedroot[<span class="number">0</span>].est[<span class="number">0</span>:<span class="number">3</span>, :].T.A</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="built_in">len</span>(confirmedroot)):</span><br><span class="line">                tmppos = numpy.vstack((tmppos,confirmedroot[i].est[<span class="number">0</span>:<span class="number">3</span>, :].T.A))</span><br><span class="line">            LinePlot.setData(pos=tmppos)</span><br><span class="line">            QtGui.QApplication.processEvents()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            LinePlot.setData(pos=np.array([<span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>]))</span><br><span class="line">            QtGui.QApplication.processEvents()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> dataOk</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># -------------------------    MAIN   -----------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Configurate the serial port</span></span><br><span class="line">CLIport, Dataport = serialConfig(configFileName)</span><br><span class="line"></span><br><span class="line"><span class="comment"># START QtAPPfor the plot</span></span><br><span class="line">app = QtGui.QApplication([])</span><br><span class="line"></span><br><span class="line">app = pg.mkQApp()</span><br><span class="line"></span><br><span class="line">view = gl.GLViewWidget()</span><br><span class="line">view.setBackgroundColor(<span class="string">&#x27;k&#x27;</span>)</span><br><span class="line">view.show()</span><br><span class="line"></span><br><span class="line">axis = gl.GLAxisItem()</span><br><span class="line">axis.scale(<span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">view.addItem(axis)</span><br><span class="line"></span><br><span class="line">LinePlot = gl.GLScatterPlotItem()</span><br><span class="line">view.addItem(LinePlot)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Main loop</span></span><br><span class="line">detObj = &#123;&#125;</span><br><span class="line">frameData = &#123;&#125;</span><br><span class="line">currentIndex = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># Update the data and check if the data is okay</span></span><br><span class="line">        dataOk = update()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> dataOk:</span><br><span class="line">            <span class="comment"># Store the current frame into frameData</span></span><br><span class="line">            frameData[currentIndex] = detObj</span><br><span class="line">            currentIndex += <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        time.sleep(<span class="number">0.01</span>)  <span class="comment"># Sampling frequency of 20 Hz</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Stop the program and close everything if Ctrl + c is pressed</span></span><br><span class="line">    <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">        CLIport.write((<span class="string">&#x27;sensorStop\n&#x27;</span>).encode())</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;sensorStop\n&#x27;</span>)</span><br><span class="line">        CLIport.close()</span><br><span class="line">        Dataport.close()</span><br><span class="line">        win.close()</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/mmWave-tutorial/" rel="tag"># mmWave_tutorial</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/09/02/xWRnote/mmWave_Tutorial2/" rel="prev" title="mmWave_Tutorial2-快速上手mmWave 3D people counting demo">
      <i class="fa fa-chevron-left"></i> mmWave_Tutorial2-快速上手mmWave 3D people counting demo
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/09/04/xWRnote/mmWave_Tutorial4/" rel="next" title="mmWave_Tutorial4-初尝mmWave Out of box demo">
      mmWave_Tutorial4-初尝mmWave Out of box demo <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E6%95%B0%E6%8D%AE"><span class="nav-number">2.</span> <span class="nav-text">测试数据</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E6%95%B0%E6%8D%AE%E5%8F%82%E6%95%B0"><span class="nav-number">2.1.</span> <span class="nav-text">测试数据参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CA-CFAR%E7%BB%93%E6%9E%9C"><span class="nav-number">2.2.</span> <span class="nav-text">CA-CFAR结果</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%9B%B8%E5%85%B3%E4%BB%A3%E7%A0%81-Matlab"><span class="nav-number">3.</span> <span class="nav-text">相关代码(Matlab)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#CA-CFAR%E4%BB%A3%E7%A0%81"><span class="nav-number">3.1.</span> <span class="nav-text">CA-CFAR代码</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%E7%BB%B4CA-CFAR"><span class="nav-number">3.1.1.</span> <span class="nav-text">一维CA-CFAR</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8C%E7%BB%B4CA-CFAR"><span class="nav-number">3.1.2.</span> <span class="nav-text">二维CA-CFAR</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CA-CFAR%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="nav-number">3.1.3.</span> <span class="nav-text">CA-CFAR使用示例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%A1%E5%B0%94%E6%9B%BC%E6%BB%A4%E6%B3%A2"><span class="nav-number">3.2.</span> <span class="nav-text">卡尔曼滤波</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C%E8%88%AA%E8%BF%B9%E5%92%8C%E7%A1%AE%E8%AE%A4%E8%88%AA%E8%BF%B9%E7%B1%BB"><span class="nav-number">3.3.</span> <span class="nav-text">实验航迹和确认航迹类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C%E8%88%AA%E8%BF%B9%E7%B1%BB-MN%E9%80%BB%E8%BE%91%E8%B5%B7%E5%A7%8B%E6%B3%95"><span class="nav-number">3.3.1.</span> <span class="nav-text">实验航迹类(MN逻辑起始法)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A1%AE%E8%AE%A4%E8%88%AA%E8%BF%B9%E7%B1%BB"><span class="nav-number">3.3.2.</span> <span class="nav-text">确认航迹类</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87%E8%B7%9F%E8%B8%AA%E4%B8%8E%E8%88%AA%E8%BF%B9%E7%AE%A1%E7%90%86%E6%AD%A5%E8%BF%9B%E5%87%BD%E6%95%B0"><span class="nav-number">3.4.</span> <span class="nav-text">目标跟踪与航迹管理步进函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#matlab%E4%BB%A3%E7%A0%81"><span class="nav-number">3.4.1.</span> <span class="nav-text">matlab代码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#python%E4%BB%A3%E7%A0%81"><span class="nav-number">3.4.2.</span> <span class="nav-text">python代码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%8C%E7%BB%B4%E8%B7%9F%E8%B8%AA"><span class="nav-number">3.4.2.1.</span> <span class="nav-text">二维跟踪</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%89%E7%BB%B4%E8%B7%9F%E8%B8%AA"><span class="nav-number">3.4.2.2.</span> <span class="nav-text">三维跟踪</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87%E8%B7%9F%E8%B8%AA%E4%B8%8E%E8%88%AA%E8%BF%B9%E7%AE%A1%E7%90%86%E5%AE%9E%E4%BE%8B%E8%84%9A%E6%9C%AC"><span class="nav-number">3.5.</span> <span class="nav-text">目标跟踪与航迹管理实例脚本</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#matlab%E7%A4%BA%E4%BE%8B"><span class="nav-number">3.5.1.</span> <span class="nav-text">matlab示例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#python%E7%A4%BA%E4%BE%8B"><span class="nav-number">3.5.2.</span> <span class="nav-text">python示例</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">YXY</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">20</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Mr-Bulijiojio" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Mr-Bulijiojio" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/frompyrmaidinside@gmail.com" title="E-Mail → frompyrmaidinside@gmail.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">YXY</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
